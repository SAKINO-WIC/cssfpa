{% extends "base.html" %}

{% block title %}添加新学生 - 入党积极分子综合评分系统{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0">
        <!-- 侧边栏 -->
        <div class="col-md-2 d-flex glass-sidebar p-0">
            <div class="sidebar-content w-100">
                <div class="sidebar-header text-center py-4">
                    <h2 class="navbar-title text-white mb-0">评分系统</h2>
                </div>
                <div class="sidebar-user text-center">
                    <div class="avatar-placeholder rounded-circle mx-auto mb-2">
                        <span>{{ current_user.username[0] }}</span>
                    </div>
                    <h5 class="text-white mb-0">{{ current_user.username }}</h5>
                    <small class="text-white-50">教师</small>
                </div>
                <div class="sidebar-nav">
                    <div class="sidebar-item active">
                        <a href="{{ url_for('teacher.index') }}" class="sidebar-link active">
                            <i class="fas fa-user-graduate me-2"></i>学生管理
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="{{ url_for('teacher.score_configs') }}" class="sidebar-link">
                            <i class="fas fa-cog me-2"></i>评分配置
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="{{ url_for('teacher.batch_calculate') }}" class="sidebar-link">
                            <i class="fas fa-calculator me-2"></i>批量评分
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="{{ url_for('teacher.reports') }}" class="sidebar-link">
                            <i class="fas fa-chart-bar me-2"></i>数据统计
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="{{ url_for('teacher.change_password') }}" class="sidebar-link">
                            <i class="fas fa-key me-2"></i>修改密码
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="{{ url_for('auth.logout') }}" class="sidebar-link">
                            <i class="fas fa-sign-out-alt me-2"></i>登出
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <main class="col-md-10 main-content">
            <div class="d-md-none text-end mb-2">
                <button class="btn btn-primary sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">添加新学生</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a href="{{ url_for('teacher.index') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i> 返回
                    </a>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-body">
                    <form method="POST" class="needs-validation" novalidate>
                        {{ form.csrf_token }}
                        
                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h5 class="border-bottom pb-2">个人基本信息</h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="student_id">{{ form.student_id.label }}</label>
                                {{ form.student_id(class="form-control") }}
                                {% for error in form.student_id.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="name">{{ form.name.label }}</label>
                                {{ form.name(class="form-control") }}
                                {% for error in form.name.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="gender">{{ form.gender.label }}</label>
                                {{ form.gender(class="form-control") }}
                                {% for error in form.gender.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="ethnicity">{{ form.ethnicity.label }}</label>
                                {{ form.ethnicity(class="form-control") }}
                                {% for error in form.ethnicity.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="hometown">{{ form.hometown.label }}</label>
                                {{ form.hometown(class="form-control") }}
                                {% for error in form.hometown.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="birth_date">{{ form.birth_date.label }}</label>
                                {{ form.birth_date(class="form-control", type="date") }}
                                {% for error in form.birth_date.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="id_card">{{ form.id_card.label }}</label>
                                {{ form.id_card(class="form-control") }}
                                {% for error in form.id_card.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="phone">{{ form.phone.label }}</label>
                                {{ form.phone(class="form-control") }}
                                {% for error in form.phone.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="email">{{ form.email.label }}</label>
                                {{ form.email(class="form-control") }}
                                {% for error in form.email.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="address">{{ form.address.label }}</label>
                                {{ form.address(class="form-control") }}
                                {% for error in form.address.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h5 class="border-bottom pb-2">学籍信息</h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="department">{{ form.department.label }}</label>
                                {{ form.department(class="form-control") }}
                                {% for error in form.department.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="major">{{ form.major.label }}</label>
                                {{ form.major(class="form-control") }}
                                {% for error in form.major.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="class_name">{{ form.class_name.label }}</label>
                                {{ form.class_name(class="form-control") }}
                                {% for error in form.class_name.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="enrollment_date">{{ form.enrollment_date.label }}</label>
                                {{ form.enrollment_date(class="form-control", type="date") }}
                                {% for error in form.enrollment_date.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h5 class="border-bottom pb-2">政治信息</h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="political_status">{{ form.political_status.label }}</label>
                                {{ form.political_status(class="form-control") }}
                                {% for error in form.political_status.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="league_member_id">{{ form.league_member_id.label }}</label>
                                {{ form.league_member_id(class="form-control") }}
                                {% for error in form.league_member_id.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="league_branch">{{ form.league_branch.label }}</label>
                                {{ form.league_branch(class="form-control") }}
                                {% for error in form.league_branch.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="league_join_date">{{ form.league_join_date.label }}</label>
                                {{ form.league_join_date(class="form-control", type="date") }}
                                {% for error in form.league_join_date.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check mt-4">
                                    {{ form.has_application(class="form-check-input") }}
                                    <label class="form-check-label" for="has_application">
                                        {{ form.has_application.label }}
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="application_date">{{ form.application_date.label }}</label>
                                {{ form.application_date(class="form-control", type="date") }}
                                {% for error in form.application_date.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="form-check">
                                    {{ form.passed_exam(class="form-check-input") }}
                                    <label class="form-check-label" for="passed_exam">
                                        {{ form.passed_exam.label }}
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check">
                                    {{ form.class_approved(class="form-check-input") }}
                                    <label class="form-check-label" for="class_approved">
                                        {{ form.class_approved.label }}
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h5 class="border-bottom pb-2">学业信息</h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <div class="form-check">
                                    {{ form.has_failed_course(class="form-check-input") }}
                                    <label class="form-check-label" for="has_failed_course">
                                        {{ form.has_failed_course.label }}
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="comprehensive_test_score">{{ form.comprehensive_test_score.label }}</label>
                                {{ form.comprehensive_test_score(class="form-control") }}
                                {% for error in form.comprehensive_test_score.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="english_level">{{ form.english_level.label }}</label>
                                {{ form.english_level(class="form-control") }}
                                {% for error in form.english_level.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="volunteer_hours">{{ form.volunteer_hours.label }}</label>
                                {{ form.volunteer_hours(class="form-control") }}
                                {% for error in form.volunteer_hours.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cet4_score">{{ form.cet4_score.label }}</label>
                                {{ form.cet4_score(class="form-control") }}
                                {% for error in form.cet4_score.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cet6_score">{{ form.cet6_score.label }}</label>
                                {{ form.cet6_score(class="form-control") }}
                                {% for error in form.cet6_score.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="scholarship">{{ form.scholarship.label }}</label>
                                {{ form.scholarship(class="form-control", rows=3) }}
                                <small class="form-text text-muted">请填写所获奖学金情况，多个奖项请用分号或换行分隔</small>
                                {% for error in form.scholarship.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h5 class="border-bottom pb-2">成就经历</h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="awards">{{ form.awards.label }}</label>
                                {{ form.awards(class="form-control", rows=3) }}
                                <small class="form-text text-muted">请填写获得的奖项和荣誉，多个奖项请用分号或换行分隔</small>
                                {% for error in form.awards.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="social_practice">{{ form.social_practice.label }}</label>
                                {{ form.social_practice(class="form-control", rows=3) }}
                                <small class="form-text text-muted">请填写参与的社会实践活动，包括志愿服务等</small>
                                {% for error in form.social_practice.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h5 class="border-bottom pb-2">账号信息</h5>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label>用户名</label>
                                <input type="text" class="form-control" id="username" readonly>
                                <small class="form-text text-muted">用户名与学号相同，系统自动生成</small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>默认密码</label>
                                <input type="text" class="form-control" id="default_password" readonly>
                                <small class="form-text text-muted">默认密码为学号后六位</small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="password">{{ form.password.label }}（可选）</label>
                                {{ form.password(class="form-control") }}
                                <small class="form-text text-muted">如需指定其他密码，请在此处填写</small>
                                {% for error in form.password.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <button class="btn btn-primary" type="submit">添加学生</button>
                                <a href="{{ url_for('teacher.index') }}" class="btn btn-secondary">取消</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    :root {
        --primary-color: #c91c23;
        --secondary-color: #6f42c1;
        --success-color: #1cc88a;
        --info-color: #36b9cc;
        --warning-color: #f6c23e;
        --danger-color: #e74a3b;
        --light-color: #f8f9fc;
        --dark-color: #5a5c69;
        --party-red: #c91c23;
        --party-red-rgb: 201, 28, 35;
    }
    
    /* 主内容区样式 */
    .main-content {
        padding: 20px;
        transition: margin-left 0.3s ease;
    }
    
    /* 侧边栏 */
    .glass-sidebar {
        background-color: #c91c23;
        height: 100vh;
        position: sticky;
        top: 0;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        z-index: 100;
        overflow-y: auto;
    }
    
    .sidebar-content {
        padding-bottom: 40px;
    }
    
    .sidebar-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .navbar-title {
        font-size: 1.1rem;
        font-weight: 400;
        letter-spacing: 1px;
    }
    
    .sidebar-user {
        padding: 20px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .avatar-placeholder {
        width: 80px;
        height: 80px;
        background-color: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .sidebar-nav {
        padding: 15px;
    }
    
    .sidebar-item {
        margin-bottom: 5px;
    }
    
    .sidebar-item.active .sidebar-link {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
    }
    
    .sidebar-link {
        display: block;
        padding: 12px 15px;
        color: rgba(255, 255, 255, 0.9);
        border-radius: 5px;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 0.95rem;
    }
    
    .sidebar-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
    }
    
    /* 适应性修复 */
    @media (max-width: 992px) {
        .glass-sidebar {
            position: fixed;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            height: 100%;
            z-index: 1000;
        }
        
        .glass-sidebar.show {
            transform: translateX(0);
        }
        
        .main-content {
            margin-left: 0 !important;
            width: 100%;
        }
    }
    
    /* 表单样式 */
    .form-control:focus, .form-select:focus {
        border-color: var(--party-red);
        box-shadow: 0 0 0 0.25rem rgba(201, 28, 35, 0.25);
    }
    
    .btn-primary {
        background-color: var(--party-red);
        border-color: var(--party-red);
    }
    
    .btn-primary:hover, .btn-primary:focus {
        background-color: #a91520;
        border-color: #a91520;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 移动端侧边栏切换
        const sidebarToggle = document.querySelector('.sidebar-toggle');
        const sidebar = document.querySelector('.glass-sidebar');
        
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('show');
            });
            
            // 点击主内容区域时关闭侧边栏
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.addEventListener('click', function(e) {
                    if (window.innerWidth < 992 && sidebar.classList.contains('show')) {
                        sidebar.classList.remove('show');
                    }
                });
            }
        }
    });
</script>
{% endblock %} 